<script lang="ts">
	import { settings } from "$lib/utils/stores";

	export let duration: number;
	export let paused: boolean;
	export let started: boolean;
	export let finished: boolean;
</script>

<div
	class={`c-progress-bar`}
	role="progressbar"
	data-border={$settings.progressBarBackgroundBorder !== 0}
	data-started={started}
	data-paused={paused}
	data-finished={finished}
	data-type={$settings.progressBarType}
	aria-label="Time Elapsed"
>
	<div class="progress-value" style:animation-duration={duration + "ms"} />
</div>

<style lang="scss">
	.c-progress-bar {
		background-color: var(--c-container);

		&[data-type="background"] {
			position: absolute;
			inset: 0;
			// to round the corners but not the progress value in the middle
			overflow: hidden;

			.progress-value {
				top: 0;
				bottom: 0;
				left: 0;
			}
		}

		&[data-type="line"] {
			position: relative;
			width: calc(100% - 4rem);

			height: 2px;
			border-radius: 1rem;

			.progress-value {
				// ! don't use `inset` as the `right` value
				// needs to be overridden by the `.progress-value`
				// selector below
				top: calc(var(--l-progress-bar--line__height) / -2);
				bottom: calc(var(--l-progress-bar--line__height) / -2);
				left: 0;

				border-radius: inherit;
			}
		}

		&[data-paused="true"] .progress-value {
			animation-play-state: paused;
		}

		// sometimes the duration and the amount of time elapsed is slightly
		// off, when the user subtracts time to cause a finish.
		// this ensures that the progress bar is always filled.
		&[data-finished="true"] .progress-value {
			animation-duration: 0ms !important;
		}

		// reset the animation when starting the timer
		&[data-started="true"] .progress-value {
			animation-name: timer-progress-bar;
		}

		&[data-started="false"] .progress-value {
			animation-name: none;
		}

		// place box shadow above progress-value
		&[data-border="true"] {
			border: var(--l-progress-bar--bg__border-width) solid #393939;
			&::before {
				content: "";

				box-shadow: var(--shadow-2--inset);

				position: absolute;
				inset: 0;
				z-index: 1;

				// border-radius: inherit;

				pointer-events: none;
			}
		}
	}

	.progress-value {
		position: absolute;
		right: 100%;

		background-color: var(--c-progress-bar--value__color);

		animation: timer-progress-bar linear forwards;
	}

	@keyframes timer-progress-bar {
		from {
			right: 100%;
		}

		to {
			right: 0%;
		}
	}
</style>
